const { Telegraf, Markup } = require("telegraf");

const BOT_TOKEN = process.env.BOT_TOKEN;
const PAYMENT_URL = process.env.PAYMENT_URL || "https://example.com/pay";

if (!BOT_TOKEN) {
  throw new Error("BOT_TOKEN is missing");
}

const bot = new Telegraf(BOT_TOKEN);

// ====== START ======
bot.start((ctx) => {
  ctx.reply(
    "ðŸ‘‹ Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð² SalonFlow!\n\n" +
      "Ð­Ñ‚Ð¾ Telegram-CRM Ð´Ð»Ñ ÑÐ°Ð»Ð¾Ð½Ð¾Ð² ÐºÑ€Ð°ÑÐ¾Ñ‚Ñ‹ Ð² Ð£ÐºÑ€Ð°Ð¸Ð½Ðµ ðŸ‡ºðŸ‡¦\n\n" +
      "Ð¡ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ Ð±Ð¾Ñ‚Ð° Ð²Ñ‹:\n" +
      "â€” Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð¸Ñ€ÑƒÐµÑ‚Ðµ Ð·Ð°Ð¿Ð¸ÑÑŒ\n" +
      "â€” ÑÐ¾ÐºÑ€Ð°Ñ‚Ð¸Ñ‚Ðµ Ð¾Ñ‚Ð¼ÐµÐ½Ñ‹\n" +
      "â€” Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ Ð¾Ð½Ð»Ð°Ð¹Ð½-Ð¿Ñ€ÐµÐ´Ð¾Ð¿Ð»Ð°Ñ‚Ñƒ\n" +
      "â€” Ð·Ð°Ð±ÑƒÐ´ÐµÑ‚Ðµ Ð¿Ñ€Ð¾ Ñ€ÑƒÑ‡Ð½Ñ‹Ðµ Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ñ\n\n" +
      "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ ðŸ‘‡",
    Markup.keyboard([
      ["ðŸ”¥ ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ ÐºÐ°Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚", "ðŸ’° Ð¢Ð°Ñ€Ð¸Ñ„Ñ‹"],
      ["ðŸš€ ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ ÑÐ°Ð»Ð¾Ð½", "â“ Ð’Ð¾Ð¿Ñ€Ð¾ÑÑ‹"],
      ["ðŸ’³ ÐžÐ½Ð»Ð°Ð¹Ð½ Ð¾Ð¿Ð»Ð°Ñ‚Ð° (Ð´ÐµÐ¼Ð¾)"]
    ]).resize()
  );
});

// ====== Ð”Ð•ÐœÐž Ð—ÐÐŸÐ˜Ð¡Ð˜ ======
bot.hears("ðŸ”¥ ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ ÐºÐ°Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚", (ctx) => {
  ctx.reply(
    "ðŸ“… Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑƒÑÐ»ÑƒÐ³Ñƒ:",
    Markup.keyboard([
      ["ÐœÐ°Ð½Ð¸ÐºÑŽÑ€", "ÐŸÐµÐ´Ð¸ÐºÑŽÑ€"],
      ["Ð‘Ñ€Ð¾Ð²Ð¸", "â¬…ï¸ ÐÐ°Ð·Ð°Ð´"]
    ]).resize()
  );
});

bot.hears(["ÐœÐ°Ð½Ð¸ÐºÑŽÑ€", "ÐŸÐµÐ´Ð¸ÐºÑŽÑ€", "Ð‘Ñ€Ð¾Ð²Ð¸"], (ctx) => {
  ctx.reply(
    "ðŸ‘©â€ðŸŽ¨ Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¼Ð°ÑÑ‚ÐµÑ€Ð°:",
    Markup.keyboard([
      ["ÐÐ½Ð½Ð°", "ÐœÐ°Ñ€Ð¸Ñ"],
      ["â¬…ï¸ ÐÐ°Ð·Ð°Ð´"]
    ]).resize()
  );
});

bot.hears(["ÐÐ½Ð½Ð°", "ÐœÐ°Ñ€Ð¸Ñ"], (ctx) => {
  ctx.reply(
    "â° Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð²Ñ€ÐµÐ¼Ñ:",
    Markup.keyboard([
      ["Ð—Ð°Ð²Ñ‚Ñ€Ð° 12:00", "Ð—Ð°Ð²Ñ‚Ñ€Ð° 15:00"],
      ["â¬…ï¸ ÐÐ°Ð·Ð°Ð´"]
    ]).resize()
  );
});

bot.hears(["Ð—Ð°Ð²Ñ‚Ñ€Ð° 12:00", "Ð—Ð°Ð²Ñ‚Ñ€Ð° 15:00"], (ctx) => {
  ctx.reply(
    "âœ… Ð—Ð°Ð¿Ð¸ÑÑŒ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð°!\n\n" +
      "ÐšÐ»Ð¸ÐµÐ½Ñ‚ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚:\n" +
      "ðŸ”” ÐÐ°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ðµ Ð·Ð° 24 Ñ‡Ð°ÑÐ°\n" +
      "ðŸ”” ÐÐ°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ðµ Ð·Ð° 2 Ñ‡Ð°ÑÐ°\n\n" +
      "ðŸ’³ ÐŸÑ€Ð¸ Ð²ÐºÐ»ÑŽÑ‡Ñ‘Ð½Ð½Ð¾Ð¹ Ð¿Ñ€ÐµÐ´Ð¾Ð¿Ð»Ð°Ñ‚Ðµ â€” ÑÑÑ‹Ð»ÐºÐ° Ð½Ð° Ð¾Ð¿Ð»Ð°Ñ‚Ñƒ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ÑÑ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ."
  );

  // Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ Ð³Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ
  ctx.reply(
    "Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð² Ð³Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ:",
    Markup.keyboard([
      ["ðŸ”¥ ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ ÐºÐ°Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚", "ðŸ’° Ð¢Ð°Ñ€Ð¸Ñ„Ñ‹"],
      ["ðŸš€ ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ ÑÐ°Ð»Ð¾Ð½", "â“ Ð’Ð¾Ð¿Ñ€Ð¾ÑÑ‹"],
      ["ðŸ’³ ÐžÐ½Ð»Ð°Ð¹Ð½ Ð¾Ð¿Ð»Ð°Ñ‚Ð° (Ð´ÐµÐ¼Ð¾)"]
    ]).resize()
  );
});

// ====== Ð¢ÐÐ Ð˜Ð¤Ð« ======
bot.hears("ðŸ’° Ð¢Ð°Ñ€Ð¸Ñ„Ñ‹", (ctx) => {
  ctx.reply(
    "ðŸ’° Ð¢Ð°Ñ€Ð¸Ñ„Ñ‹ SalonFlow:\n\n" +
      "Starter â€” 500 Ð³Ñ€Ð½/Ð¼ÐµÑ\n" +
      "Pro â€” 800 Ð³Ñ€Ð½/Ð¼ÐµÑ\n" +
      "Salon â€” 1500 Ð³Ñ€Ð½/Ð¼ÐµÑ\n\n" +
      "ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð·Ð° 24 Ñ‡Ð°ÑÐ°."
  );
});

// ====== ÐŸÐžÐ”ÐšÐ›Ð®Ð§Ð•ÐÐ˜Ð• ======
bot.hears("ðŸš€ ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ ÑÐ°Ð»Ð¾Ð½", (ctx) => {
  ctx.reply(
    "ðŸš€ Ð”Ð»Ñ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð½Ð°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ:\n\n" +
      "1) Ð“Ð¾Ñ€Ð¾Ð´\n" +
      "2) ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¼Ð°ÑÑ‚ÐµÑ€Ð¾Ð²\n" +
      "3) ÐÑƒÐ¶Ð½Ð° Ð»Ð¸ Ð¿Ñ€ÐµÐ´Ð¾Ð¿Ð»Ð°Ñ‚Ð°\n" +
      "4) ÐÑƒÐ¶Ð½Ð° Ð»Ð¸ ÐºÐ½Ð¾Ð¿ÐºÐ° Â«ÐžÐ½Ð»Ð°Ð¹Ð½ Ð¾Ð¿Ð»Ð°Ñ‚Ð°?Â»"
  );
});

// ====== Ð’ÐžÐŸÐ ÐžÐ¡Ð« ======
bot.hears("â“ Ð’Ð¾Ð¿Ñ€Ð¾ÑÑ‹", (ctx) => {
  ctx.reply(
    "â“ Ð§Ð°ÑÑ‚Ñ‹Ðµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹:\n\n" +
      "â€” Ð’ÑÑ‘ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ Telegram\n" +
      "â€” Ð•ÑÑ‚ÑŒ Ð°Ð²Ñ‚Ð¾Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ñ\n" +
      "â€” ÐžÐ½Ð»Ð°Ð¹Ð½-Ð¾Ð¿Ð»Ð°Ñ‚Ð° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ÑÑ\n" +
      "â€” ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð·Ð° 24 Ñ‡Ð°ÑÐ°"
  );
});

// ====== ÐžÐÐ›ÐÐ™Ð ÐžÐŸÐ›ÐÐ¢Ð ======
bot.hears("ðŸ’³ ÐžÐ½Ð»Ð°Ð¹Ð½ Ð¾Ð¿Ð»Ð°Ñ‚Ð° (Ð´ÐµÐ¼Ð¾)", (ctx) => {
  ctx.reply(
    "ðŸ’³ ÐŸÑ€Ð¸Ð¼ÐµÑ€ ÑÑÑ‹Ð»ÐºÐ¸ Ð½Ð° Ð¾Ð¿Ð»Ð°Ñ‚Ñƒ:\n\n" +
      PAYMENT_URL
  );
});

bot.launch();
console.log("Sales bot started");

process.once("SIGINT", () => bot.stop("SIGINT"));
process.once("SIGTERM", () => bot.stop("SIGTERM"));


console.log("Sales bot started");
