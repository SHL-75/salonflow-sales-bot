const { Telegraf, Markup } = require("telegraf");

const BOT_TOKEN = process.env.BOT_TOKEN;
const PAYMENT_URL = process.env.PAYMENT_URL || "https://example.com/pay";

if (!BOT_TOKEN) {
  throw new Error("BOT_TOKEN is missing");
}

const bot = new Telegraf(BOT_TOKEN);

// ====== START / MAIN MENU ======
bot.start((ctx) => {
  ctx.reply(
    "SalonFlow â€” Telegram CRM Ð´Ð»Ñ ÑÐ°Ð»Ð¾Ð½Ð¾Ð² ðŸš€\n\n" +
      "âœ… ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð·Ð°Ð¿Ð¸ÑÑŒ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð²\n" +
      "âœ… ÐŸÑ€ÐµÐ´Ð¾Ð¿Ð»Ð°Ñ‚Ð° (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)\n" +
      "âœ… ÐÐ°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ñ Ð±ÐµÐ· Ñ€ÑƒÑ‡Ð½Ð¾Ð¹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹\n\n" +
      "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ:",
    Markup.keyboard([
      ["ðŸ”¥ ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ ÐºÐ°Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚", "ðŸ’° Ð¢Ð°Ñ€Ð¸Ñ„Ñ‹"],
      ["ðŸš€ ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ ÑÐ°Ð»Ð¾Ð½", "â“ Ð’Ð¾Ð¿Ñ€Ð¾ÑÑ‹"],
      ["ðŸ’³ ÐžÐ½Ð»Ð°Ð¹Ð½ Ð¾Ð¿Ð»Ð°Ñ‚Ð° (Ð´ÐµÐ¼Ð¾)"]
    ]).resize()
  );
});

// ====== BUTTON HANDLERS ======
bot.hears("ðŸ”¥ ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ ÐºÐ°Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚", (ctx) => {
  ctx.reply(
    "ðŸŽ¬ Ð”ÐµÐ¼Ð¾ Ð·Ð°Ð¿Ð¸ÑÐ¸ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°:\n\n" +
      "1ï¸âƒ£ ÐšÐ»Ð¸ÐµÐ½Ñ‚ Ð²Ñ‹Ð±Ð¸Ñ€Ð°ÐµÑ‚ ÑƒÑÐ»ÑƒÐ³Ñƒ\n" +
      "2ï¸âƒ£ Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÑ‚ Ð¼Ð°ÑÑ‚ÐµÑ€Ð°\n" +
      "3ï¸âƒ£ Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÑ‚ Ð²Ñ€ÐµÐ¼Ñ\n" +
      "4ï¸âƒ£ ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ðµ\n" +
      "5ï¸âƒ£ ÐÐ²Ñ‚Ð¾Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ðµ Ð·Ð° 24 Ñ‡Ð°ÑÐ°\n" +
      "6ï¸âƒ£ ÐÐ²Ñ‚Ð¾Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ðµ Ð·Ð° 2 Ñ‡Ð°ÑÐ°"
  );
});

bot.hears("ðŸ’° Ð¢Ð°Ñ€Ð¸Ñ„Ñ‹", (ctx) => {
  ctx.reply(
    "ðŸ’° Ð¢Ð°Ñ€Ð¸Ñ„Ñ‹ SalonFlow:\n\n" +
      "Starter â€” 500 Ð³Ñ€Ð½/Ð¼ÐµÑ\n" +
      "Pro â€” 800 Ð³Ñ€Ð½/Ð¼ÐµÑ\n" +
      "Salon â€” 1500 Ð³Ñ€Ð½/Ð¼ÐµÑ"
  );
});

bot.hears("ðŸš€ ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ ÑÐ°Ð»Ð¾Ð½", (ctx) => {
  ctx.reply(
    "ðŸš€ Ð”Ð»Ñ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð½Ð°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ:\n\n" +
      "1) Ð“Ð¾Ñ€Ð¾Ð´\n" +
      "2) ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¼Ð°ÑÑ‚ÐµÑ€Ð¾Ð²\n" +
      "3) ÐÑƒÐ¶Ð½Ð° Ð»Ð¸ Ð¿Ñ€ÐµÐ´Ð¾Ð¿Ð»Ð°Ñ‚Ð°\n" +
      "4) ÐÑƒÐ¶Ð½Ð° Ð»Ð¸ ÐºÐ½Ð¾Ð¿ÐºÐ° Â«ÐžÐ½Ð»Ð°Ð¹Ð½ Ð¾Ð¿Ð»Ð°Ñ‚Ð°?Â»\n\n" +
      "ðŸ’³ Ð•ÑÐ»Ð¸ Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð¾Ð½Ð»Ð°Ð¹Ð½-Ð¾Ð¿Ð»Ð°Ñ‚Ñƒ â€” ÐºÐ»Ð¸ÐµÐ½Ñ‚ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ ÑÑÑ‹Ð»ÐºÑƒ Ð¿Ñ€ÑÐ¼Ð¾ Ð² Telegram."
  );
});

bot.hears("â“ Ð’Ð¾Ð¿Ñ€Ð¾ÑÑ‹", (ctx) => {
  ctx.reply(
    "â“ Ð§Ð°ÑÑ‚Ñ‹Ðµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹:\n\n" +
      "â€” Ð’ÑÑ‘ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ Telegram\n" +
      "â€” Ð•ÑÑ‚ÑŒ Ð°Ð²Ñ‚Ð¾Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ñ\n" +
      "â€” ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð·Ð° 24 Ñ‡Ð°ÑÐ°"
  );
});

bot.hears("ðŸ’³ ÐžÐ½Ð»Ð°Ð¹Ð½ Ð¾Ð¿Ð»Ð°Ñ‚Ð° (Ð´ÐµÐ¼Ð¾)", (ctx) => {
  ctx.reply(
    "ðŸ’³ ÐžÐ½Ð»Ð°Ð¹Ð½ Ð¾Ð¿Ð»Ð°Ñ‚Ð°\n\n" +
      "ÐšÐ»Ð¸ÐµÐ½Ñ‚ Ð½Ð°Ð¶Ð¸Ð¼Ð°ÐµÑ‚ Â«ÐžÐ¿Ð»Ð°Ñ‚Ð° Ð¾Ð½Ð»Ð°Ð¹Ð½?Â» Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ ÑÑÑ‹Ð»ÐºÑƒ:\n" +
      PAYMENT_URL
  );
});

// ====== LAUNCH ======
bot.launch();
console.log("Sales bot started");

// Graceful stop (Railway)
process.once("SIGINT", () => bot.stop("SIGINT"));
process.once("SIGTERM", () => bot.stop("SIGTERM"));


console.log("Sales bot started");
