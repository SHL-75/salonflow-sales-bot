const { Telegraf, Markup } = require("telegraf");

const BOT_TOKEN = process.env.BOT_TOKEN;
const PAYMENT_URL = process.env.PAYMENT_URL || "https://example.com/pay";

if (!BOT_TOKEN) {
  throw new Error("BOT_TOKEN is missing");
}

const bot = new Telegraf(BOT_TOKEN);

// Ð¥Ñ€Ð°Ð½Ð¸Ð¼ ÑÐ·Ñ‹Ðº Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ (Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ðµ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð² Ð¿Ð°Ð¼ÑÑ‚Ð¸)
const userLang = {};

// ====== START ======
bot.start((ctx) => {
  ctx.reply(
    "ðŸŒ ÐžÐ±ÐµÑ€Ñ–Ñ‚ÑŒ Ð¼Ð¾Ð²Ñƒ / Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÐ·Ñ‹Ðº:",
    Markup.keyboard([
      ["ðŸ‡ºðŸ‡¦ Ð£ÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÐ°", "ðŸ‡·ðŸ‡º Ð ÑƒÑÑÐºÐ¸Ð¹"]
    ]).resize()
  );
});

// ====== Ð’Ð«Ð‘ÐžÐ  Ð¯Ð—Ð«ÐšÐ ======
bot.hears("ðŸ‡ºðŸ‡¦ Ð£ÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÐ°", (ctx) => {
  userLang[ctx.from.id] = "ua";
  sendMainMenu(ctx);
});

bot.hears("ðŸ‡·ðŸ‡º Ð ÑƒÑÑÐºÐ¸Ð¹", (ctx) => {
  userLang[ctx.from.id] = "ru";
  sendMainMenu(ctx);
});

// ====== Ð“Ð›ÐÐ’ÐÐžÐ• ÐœÐ•ÐÐ® ======
function sendMainMenu(ctx) {
  const lang = userLang[ctx.from.id] || "ru";

  if (lang === "ua") {
    ctx.reply(
      "ðŸ‘‹ Ð›Ð°ÑÐºÐ°Ð²Ð¾ Ð¿Ñ€Ð¾ÑÐ¸Ð¼Ð¾ Ð´Ð¾ SalonFlow!\n\n" +
        "Telegram-CRM Ð´Ð»Ñ ÑÐ°Ð»Ð¾Ð½Ñ–Ð² ÐºÑ€Ð°ÑÐ¸ ðŸ‡ºðŸ‡¦\n\n" +
        "Ð’Ð¸ Ð·Ð¼Ð¾Ð¶ÐµÑ‚Ðµ:\n" +
        "â€” Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·ÑƒÐ²Ð°Ñ‚Ð¸ Ð·Ð°Ð¿Ð¸Ñ\n" +
        "â€” Ð·Ð¼ÐµÐ½ÑˆÐ¸Ñ‚Ð¸ ÑÐºÐ°ÑÑƒÐ²Ð°Ð½Ð½Ñ\n" +
        "â€” Ð¿Ñ–Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ð¸ Ð¾Ð½Ð»Ð°Ð¹Ð½-Ð¾Ð¿Ð»Ð°Ñ‚Ñƒ\n" +
        "â€” Ð¾Ñ‚Ñ€Ð¸Ð¼ÑƒÐ²Ð°Ñ‚Ð¸ Ð°Ð²Ñ‚Ð¾Ð½Ð°Ð³Ð°Ð´ÑƒÐ²Ð°Ð½Ð½Ñ\n\n" +
        "ÐžÐ±ÐµÑ€Ñ–Ñ‚ÑŒ Ð´Ñ–ÑŽ ðŸ‘‡",
      Markup.keyboard([
        ["ðŸ”¥ ÐŸÐ¾Ð´Ð¸Ð²Ð¸Ñ‚Ð¸ÑÑŒ ÑÐº Ð¿Ñ€Ð°Ñ†ÑŽÑ”", "ðŸ’° Ð¢Ð°Ñ€Ð¸Ñ„Ð¸"],
        ["ðŸš€ ÐŸÑ–Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ð¸ ÑÐ°Ð»Ð¾Ð½", "â“ ÐŸÐ¸Ñ‚Ð°Ð½Ð½Ñ"],
        ["ðŸ’³ ÐžÐ½Ð»Ð°Ð¹Ð½ Ð¾Ð¿Ð»Ð°Ñ‚Ð° (Ð´ÐµÐ¼Ð¾)"]
      ]).resize()
    );
  } else {
    ctx.reply(
      "ðŸ‘‹ Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð² SalonFlow!\n\n" +
        "Telegram-CRM Ð´Ð»Ñ ÑÐ°Ð»Ð¾Ð½Ð¾Ð² ÐºÑ€Ð°ÑÐ¾Ñ‚Ñ‹ ðŸ‡ºðŸ‡¦\n\n" +
        "Ð’Ñ‹ ÑÐ¼Ð¾Ð¶ÐµÑ‚Ðµ:\n" +
        "â€” Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÑŒ\n" +
        "â€” ÑÐ¾ÐºÑ€Ð°Ñ‚Ð¸Ñ‚ÑŒ Ð¾Ñ‚Ð¼ÐµÐ½Ñ‹\n" +
        "â€” Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð¾Ð½Ð»Ð°Ð¹Ð½-Ð¾Ð¿Ð»Ð°Ñ‚Ñƒ\n" +
        "â€” Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ñ‚ÑŒ Ð°Ð²Ñ‚Ð¾Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ñ\n\n" +
        "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ ðŸ‘‡",
      Markup.keyboard([
        ["ðŸ”¥ ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ ÐºÐ°Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚", "ðŸ’° Ð¢Ð°Ñ€Ð¸Ñ„Ñ‹"],
        ["ðŸš€ ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ ÑÐ°Ð»Ð¾Ð½", "â“ Ð’Ð¾Ð¿Ñ€Ð¾ÑÑ‹"],
        ["ðŸ’³ ÐžÐ½Ð»Ð°Ð¹Ð½ Ð¾Ð¿Ð»Ð°Ñ‚Ð° (Ð´ÐµÐ¼Ð¾)"]
      ]).resize()
    );
  }
}

bot.launch();
console.log("Sales bot started");

process.once("SIGINT", () => bot.stop("SIGINT"));
process.once("SIGTERM", () => bot.stop("SIGTERM"));


console.log("Sales bot started");
